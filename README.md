<h1 align="center">   PEIT: a framework for Property Enhanced Instruction Tuning for multi-task molecular generation with LLMs.  </h1>
<h3 align="center">  </h3>
## Files
* `Template_Generation/`: Contains the all the template filling code of four downstream tasks.
* `PEIT_pretrain.py/` runs PEIT-GEN pre-training.
* `calc_property.py/` Codes for calculate the molecular properties.
* `llama3_lora_sft.yaml` runs PEIT-LLMs sft.
* `example_*` The examples generated by PEIT-GEN for SFT.
## Requirements
Run `pip install -r requirements.txt` to install the required packages.
## Code running
Arguments can be passed with commands, or be edited manually in the running code.
1. Pre-training for PEIT-GEN
    ```
    python PEIT_pretrain.py --data_path './data/pretrain_data.csv'
    ```
2. SFT for PEIT-LLM
    ```
    llamafactory-cli train llama3_lora_sft.yaml
    ```
## Experimental Results

#### Molecule Captioning
| Model | BLEU-2 | BLEU-4 | METEOR | ROUGE-1 | ROUGE-2 | ROUGE-L |
|-------|--------|--------|--------|---------|---------|---------|
| PEIT-GEN | **0.598** | **0.534** | **0.676** | **0.700** | **0.582** | **0.653** |
| PEIT-LLM-LLaMa3.1 | **0.461** | **0.356** | **0.502** | **0.569** | **0.396** | **0.505** |
| PEIT-LLM-Qwen2.5 | **0.422** | **0.314** | **0.468** | **0.535** | **0.361** | **0.477** |

#### Molecular Property Prediction
| Model | RMSE | R2 |
|-------|----|------|
| PEIT-GEN | **0.169** | **0.910** |

#### Molecular Property Prediction on MoleculeNet 
| Model | BBBP | BACE | Clintox | SIDER |
|-------|------|------|---------|-------|
| PEIT-GEN | **73.6±0.7** | **81.6±0.5** | **91.2±0.7** | **62.7±0.9** |

#### Text-Based Molecule Generation
| Model | BLEU | Validity | Levenshtein | MACCS FTS | Morgan FTS | RDKit FTS |
|-------|------|---------|------------|----------|-----------|----------|
| PEIT-LLM-LLaMa3.1 | **0.836** | **0.970** | **18.030** | **0.875** | **0.661** | **0.776** |
| PEIT-LLM-Qwen2.5 | **0.810** | **0.950** | **21.133** | **0.832** | **0.619** | **0.735** |

#### Multi-Constraint Molecule Generation
| Model | RMSE | R2 |
|-------|------|----|
| PEIT-LLM-LLaMa3.1 | **14.212** | **0.613** |
| PEIT-LLM-Qwen2.5 | **19.750** | **0.550** |


